<html>
  <head>
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
  </head>
  <body>
    <div id="app">
      <canvas id="chart"></canvas>
    </div>
  </body>
  <script src="./chart.js"></script>
  <script>
    var app = new Vue({
      el: '#app',
      created () {
        this.updateCommits()
      },
      data () {
        return {
          now: new Date(),
          commits: [],
          labels: []
        }
      },
      methods: {
        updateCommits () {
          axios.get('https://github-contributions-api.now.sh/v1/junhoyeo?format=nested')
            .then((res) => {
              response = res.data.contributions.contributions[new Date().getFullYear().toString()]
              for (var key in response) {
                for (var _key in response[key]) {
                  let commit = response[key][_key]
                  if (new Date(commit.date) <= this.now) {
                    this.commits.push(commit.count)
                    this.labels.push(commit.date)
                  }
                }
              }
              updateChart(
                this.labels,
                this.commits
              )
            })
        }
      }
    });
  </script>
</html>
